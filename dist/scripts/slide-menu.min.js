"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t){var e="slideMenu",n={position:"right",showBackLink:!0,keycodeOpen:null,keycodeClose:27,submenuLinkBefore:"",submenuLinkAfter:"",backLinkBefore:"",backLinkAfter:"",showOverlay:!0,dynamicSourceFetchFunction:null,dynamicSourceDataAttribute:"source",dynamicLoadingContent:"Loading..."},i=function(){function e(t){_classCallCheck(this,e),this.options=t,this._menu=t.elem,this._menu.find("ul:first").wrap('<div class="slider">'),this._anchors=this._menu.find("a"),this._slider=this._menu.find(".slider:first"),this._level=0,this._isOpen=!1,this._isAnimating=!1,this._hasMenu=this._anchors.length>0,this._lastAction=null,this._setupEventHandlers(),this._setupMenu(),this._hasMenu&&this._setupSubmenus(),this._appendOverlay()}return _createClass(e,[{key:"_appendOverlay",value:function(){var e=this;this._overlay=t('<div class="slide-menu-overlay"></div>'),this.options.showOverlay&&(this._overlay.hide().click(function(t){e.close()}),this._menu.before(this._overlay))}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0;return null===t?void(this._isOpen?this.close():this.open()):(t?(n=0,this._isOpen=!0):(n="left"===this.options.position?"-100%":"100%",this._isOpen=!1),this._triggerEvent(),void(e?this._triggerAnimation(this._menu,n):(this._pauseAnimations(this._triggerAnimation.bind(this,this._menu,n)),this._isAnimating=!1)))}},{key:"open",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._lastAction="open",this._menu.scrollTop(0),this.toggle(!0,t),this._overlay.fadeIn("fast")}},{key:"close",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._lastAction="close",this.toggle(!1,t),this._overlay.fadeOut("fast")}},{key:"back",value:function(){this._lastAction="back",this._navigate(null,-1)}},{key:"navigateTo",value:function(e){var n=this;if(e=this._menu.find(t(e)).first(),!e.length)return!1;var i=e.parents("ul"),s=i.length-1;return 0!==s&&void this._pauseAnimations(function(){n._level=s,i.show().first().addClass("active"),n._triggerAnimation(n._slider,100*-n._level)})}},{key:"_createMenuFromItems",value:function(e){var n=this,i=t("<ul/>");return e.forEach(function(t){i.append(n._createMenuItemFromObj(t))}),i}},{key:"_createMenuItemFromObj",value:function(e){var n=this,i=t("<li/>"),s=t("<a/>").attr({href:e.href,title:e.title}).text(e.title);return e[n.options.dynamicSourceDataAttribute]&&s.data(n.options.dynamicSourceDataAttribute,e[n.options.dynamicSourceDataAttribute]),i.append(s),e.items&&e.items.length&&i.append(n._createMenuFromItems(e.items)),i}},{key:"_isAnchorDynamic",value:function(t){return void 0!==t.data(this.options.dynamicSourceDataAttribute)&&null!=this.options.dynamicSourceFetchFunction}},{key:"_fetchDynamicItems",value:function(t){var e=this,n="source-fetched";if(this._isAnchorDynamic(t)&&!t.data(n)){var i=t.next("ul");if(i.find(".loading").length){var s=this.options.dynamicSourceFetchFunction.call(this,t.data(this.options.dynamicSourceDataAttribute));t.removeData(e.options.dynamicSourceDataAttribute),t.data(n,!0),s.then(function(t){t.forEach(function(t){i.append(e._createMenuItemFromObj(t))}),i.find(".loading").remove(),e._update()})}}}},{key:"_setupEventHandlers",value:function(){var e=this;this._hasMenu&&this._anchors.each(function(n,i){i=t(i),i.data("events-processed")||(i.data("events-processed",!0),i.click(function(n){var i=t(n.target).is("a")?t(n.target):t(n.target).parents("a:first");e._fetchDynamicItems(i),e._navigate(i)}))}),t(this._menu.add(this._slider)).on("transitionend msTransitionEnd",function(){e._isAnimating=!1,e._triggerEvent(!0)}),t(document).keydown(function(t){switch(t.which){case e.options.keycodeClose:e.close();break;case e.options.keycodeOpen:e.open();break;default:return}t.preventDefault()}),this._menu.on("sm.back-after",function(){var t="ul "+".active ".repeat(e._level+1);e._menu.find(t).removeClass("active").hide()})}},{key:"_triggerEvent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e="sm."+this._lastAction;t&&(e+="-after"),this._menu.trigger(e)}},{key:"_navigate",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._menu.scrollTop(0),!this._isAnimating){var i=(this._level+n)*-100;if(n>0){if(!t.next("ul").length)return void(t.is(".slide-menu-control")||(this._pauseAnimations(function(){e._level=0,e._triggerAnimation(e._slider,0)}),this.close(!0)));t.next("ul").addClass("active").show()}else if(0===this._level)return;this._lastAction=n>0?"forward":"back",this._level=this._level+n,this._triggerAnimation(this._slider,i)}}},{key:"_triggerAnimation",value:function(t,e){this._triggerEvent(),String(e).indexOf("%")===-1&&(e+="%"),t.css("transform","translateX("+e+")"),this._isAnimating=!0}},{key:"_setupMenu",value:function(){var t=this;this._pauseAnimations(function(){switch(t.options.position){case"left":t._menu.css({left:0,right:"auto",transform:"translateX(-100%)"});break;default:t._menu.css({left:"auto",right:0})}t._menu.show()})}},{key:"_pauseAnimations",value:function(t){this._menu.addClass("no-transition"),t(),this._menu[0].offsetHeight,this._menu.removeClass("no-transition")}},{key:"_processDynamicAnchor",value:function(e){if(this._isAnchorDynamic(e)){var n=t("<ul/>");n.append(t("<li/>").addClass("loading").html(this.options.dynamicLoadingContent)),e.after(n)}}},{key:"_setupSubmenus",value:function(){var e=this;this._anchors.each(function(n,i){if(i=t(i),void 0===i.data("submenu-processed")){if(e._processDynamicAnchor(i),i.next("ul").length){i.click(function(t){t.preventDefault()});var s=i.html();if(i.html(e.options.submenuLinkBefore+s+e.options.submenuLinkAfter),e.options.showBackLink){var a=t('<a href class="slide-menu-control" data-action="back">'+s+"</a>");a.html(e.options.backLinkBefore+a.html()+e.options.backLinkAfter),i.next("ul").prepend(t("<li>").append(a))}}i.data("submenu-processed",!0)}})}},{key:"_update",value:function(){this._anchors=this._menu.find("a"),this._hasMenu=this._anchors.length>0,this._setupEventHandlers(),this._setupSubmenus()}}]),e}();t("body").on("click",".slide-menu-control",function(n){var i=void 0,s=t(this).data("target");if(i=s&&"this"!==s?t("#"+s):t(this).parents(".slide-menu:first"),i.length){var a=i.data(e),o=t(this).data("action");return a&&"function"==typeof a[o]&&a[o](),!1}}),t.fn[e]=function(s){if(!t(this).length)return void console.warn("Slide Menu: Unable to find menu DOM element. Maybe a typo?");s=t.extend({},n,s),s.elem=t(this);var a=new i(s);return t(this).data(e,a),a}}(jQuery);